<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>VIB34D Holographic Engine - Refactored</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* VIB34D Refactored CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Orbitron', monospace;
            overflow: hidden;
            position: relative;
        }
        
        /* 5-Layer Holographic Canvas System */
        .holographic-layers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
        }
        
        .holographic-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: auto;
        }
        
        #background-canvas { z-index: 1; opacity: 0.6; mix-blend-mode: normal; }
        #shadow-canvas { z-index: 3; opacity: 0.4; mix-blend-mode: multiply; }
        #content-canvas { z-index: 5; opacity: 0.9; mix-blend-mode: screen; }
        #highlight-canvas { z-index: 7; opacity: 0.7; mix-blend-mode: overlay; }
        #accent-canvas { z-index: 15; opacity: 0.5; mix-blend-mode: color-dodge; }
        
        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            min-width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* Collapsible Panel States */
        .control-panel.collapsed {
            transform: translateX(calc(100% - 50px));
            opacity: 0.8;
        }
        
        .control-panel.collapsed:hover {
            transform: translateX(calc(100% - 80px));
            opacity: 0.9;
        }
        
        /* Collapse Toggle Button */
        .collapse-toggle {
            position: absolute;
            left: -40px;
            top: 10px;
            width: 35px;
            height: 35px;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #00ffff;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .collapse-toggle:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Hide control panel in preview mode */
        .preview-mode .control-panel {
            display: none !important;
        }
        
        /* Hide status in preview mode */
        .preview-mode .status {
            display: none !important;
        }
        
        .control-panel h2 {
            color: #00ffff;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Enhanced Control Header */
        .control-header {
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.05), rgba(0, 255, 255, 0.02));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .system-status {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        #currentSystemIndicator {
            font-size: 0.8rem;
            font-weight: bold;
            color: #00ffff;
        }
        
        #parameterSyncStatus {
            font-size: 0.6rem;
            color: rgba(0, 255, 0, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .quick-actions {
            display: flex;
            gap: 6px;
        }
        
        .quick-btn {
            background: rgba(0, 255, 255, 0.15);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.6rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .quick-btn:hover {
            background: rgba(0, 255, 255, 0.25);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
            transform: translateY(-1px);
        }
        
        .quick-btn:active {
            transform: translateY(0);
            box-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 8px 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #00ffff;
            border-bottom-color: #00ffff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Controls */
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .control-input {
            width: 100%;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px;
            color: #fff;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
        }
        
        .control-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }
        
        .control-display {
            display: inline-block;
            float: right;
            color: #00ffff;
            font-weight: bold;
        }
        
        /* Buttons */
        .btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .btn:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        .btn.active {
            background: rgba(0, 255, 255, 0.5);
        }
        
        /* Geometry Presets */
        .geometry-presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        /* Variation Grid */
        .variation-controls {
            margin-bottom: 15px;
        }
        
        .variation-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .variation-info {
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        /* Status */
        .status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .status.success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        
        .status.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }
        
        .status.warning {
            background: rgba(255, 255, 0, 0.2);
            border: 1px solid #ffff00;
            color: #ffff00;
        }
        
        .status.info {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
        }
        
        /* Gallery Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-content {
            position: relative;
            margin: 2% auto;
            width: 95%;
            height: 95%;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #00ffff;
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .control-panel {
                right: 10px;
                top: 10px;
                min-width: 280px;
            }
            
            .geometry-presets {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 5-Layer Holographic Canvas System -->
    <div class="holographic-layers">
        <canvas id="background-canvas" class="holographic-canvas"></canvas>
        <canvas id="shadow-canvas" class="holographic-canvas"></canvas>
        <canvas id="content-canvas" class="holographic-canvas"></canvas>
        <canvas id="highlight-canvas" class="holographic-canvas"></canvas>
        <canvas id="accent-canvas" class="holographic-canvas"></canvas>
    </div>
    
    <!-- Active Holographic System Layers -->
    <div class="holographic-layers active-holo" style="display: none;">
        <canvas id="holo-background-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-shadow-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-content-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-highlight-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-accent-canvas" class="holographic-canvas"></canvas>
    </div>
    
    <!-- Control Panel -->
    <div class="control-panel" id="controlPanel">
        <div class="collapse-toggle" id="collapseToggle" onclick="toggleControlPanel()">‹</div>
        <h2>VIB34D Holographic Engine</h2>
        
        <!-- Enhanced Control Header -->
        <div class="control-header">
            <div class="system-status">
                <span id="currentSystemIndicator">🔷 VIB34D System</span>
                <span id="parameterSyncStatus">Synced</span>
            </div>
            <div class="quick-actions">
                <button class="quick-btn" onclick="quickRandomize()" title="Quick randomize visual parameters">⚡ Quick</button>
                <button class="quick-btn" onclick="randomizeParameters()" title="Full randomization">🎲 Random</button>
                <button class="quick-btn" onclick="switchToSystem(unifiedParameters.systemType === 'VIB34D' ? 'Holographic' : 'VIB34D')" title="Switch between systems">🔄 Switch</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="variations" title="VIB34D Polytopal Variations">🔷 VIB34D</button>
            <button class="tab-btn" data-tab="polytopal" title="4D Mathematics Control">🧮 4D Math</button>
            <button class="tab-btn" data-tab="holographic" title="Holographic Parameters">🌀 Holo Params</button>
            <button class="tab-btn" data-tab="holograms" title="Active Holographic System">✨ Live Holo</button>
            <button class="tab-btn" data-tab="export" title="Export & Import System">📤 Export</button>
        </div>
        
        <!-- Variations Tab -->
        <div class="tab-content active" id="variations-tab">
            <div class="variation-controls">
                <div class="variation-nav">
                    <button class="btn" onclick="engine.previousVariation()">← Prev Preset</button>
                    <button class="btn" onclick="randomizeParameters('VIB34D')">🎲 Randomize</button>
                    <button class="btn" onclick="engine.nextVariation()">Next Preset →</button>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Variation <span class="control-display" id="currentVariationDisplay">1</span>
                    </label>
                    <input type="range" id="variationSlider" class="control-input" min="0" max="99" value="0">
                </div>
                
                <div class="variation-info">
                    <div id="currentVariation">1 - TETRAHEDRON LATTICE 1</div>
                </div>
                
                <div class="variation-nav">
                    <button class="btn" onclick="saveVIB34DToPortfolio()" style="background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">💾 Save Current</button>
                    <button class="btn" onclick="engine.openGalleryView()">Gallery</button>
                </div>
            </div>
            
            <div class="geometry-presets">
                <button class="btn active" data-geometry="0">Tetrahedron</button>
                <button class="btn" data-geometry="1">Hypercube</button>
                <button class="btn" data-geometry="2">Sphere</button>
                <button class="btn" data-geometry="3">Torus</button>
                <button class="btn" data-geometry="4">Klein Bottle</button>
                <button class="btn" data-geometry="5">Fractal</button>
                <button class="btn" data-geometry="6">Wave</button>
                <button class="btn" data-geometry="7">Crystal</button>
            </div>
        </div>
        
        <!-- 4D Math Tab -->
        <div class="tab-content" id="polytopal-tab">
            <div class="control-group">
                <label class="control-label">
                    4D Rotation XW <span class="control-display" id="rot4dXWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dXW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    4D Rotation YW <span class="control-display" id="rot4dYWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dYW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    4D Rotation ZW <span class="control-display" id="rot4dZWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dZW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Dimension <span class="control-display" id="dimensionDisplay">3.50</span>
                </label>
                <input type="range" id="dimension" class="control-input" min="3" max="4.5" step="0.01" value="3.5">
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn" onclick="randomizeParameters('VIB34D')">🎲 Randomize Parameters</button>
                <button class="btn" onclick="engine.resetToDefaults()">Reset</button>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.3);">
                <h4 style="color: #00ffff; margin-bottom: 10px; font-size: 0.9rem;">⚙️ System Controls</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn" id="vib34dAudioToggle" onclick="toggleVIB34DAudio()" style="flex: 1; font-size: 0.7rem;">🎵 Audio Off</button>
                    <button class="btn" onclick="saveVIB34DToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">💾 Save</button>
                </div>
                <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">🖼️ View Portfolio</button>
            </div>
        </div>
        
        <!-- Holographic Tab -->
        <div class="tab-content" id="holographic-tab">
            <div class="control-group">
                <label class="control-label">
                    Grid Density <span class="control-display" id="gridDensityDisplay">15.0</span>
                </label>
                <input type="range" id="gridDensity" class="control-input" min="4" max="30" step="0.1" value="15">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Morph Factor <span class="control-display" id="morphFactorDisplay">1.00</span>
                </label>
                <input type="range" id="morphFactor" class="control-input" min="0" max="2" step="0.01" value="1">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Chaos <span class="control-display" id="chaosDisplay">0.20</span>
                </label>
                <input type="range" id="chaos" class="control-input" min="0" max="1" step="0.01" value="0.2">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Speed <span class="control-display" id="speedDisplay">1.00</span>
                </label>
                <input type="range" id="speed" class="control-input" min="0.1" max="3" step="0.01" value="1">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Hue <span class="control-display" id="hueDisplay">200°</span>
                </label>
                <input type="range" id="hue" class="control-input" min="0" max="360" step="1" value="200">
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.3);">
                <h4 style="color: #00ffff; margin-bottom: 10px; font-size: 0.9rem;">⚙️ System Controls</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn" id="vib34dAudioToggle2" onclick="toggleVIB34DAudio()" style="flex: 1; font-size: 0.7rem;">🎵 Audio Off</button>
                    <button class="btn" onclick="saveVIB34DToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">💾 Save</button>
                </div>
                <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">🖼️ View Portfolio</button>
            </div>
        </div>
        
        <!-- Active Holograms Tab -->
        <div class="tab-content" id="holograms-tab">
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 15px;">Active Holographic System</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn" id="toggle-holo" onclick="toggleHolographicSystem()">Activate Holograms</button>
                </div>
            </div>
            
            <div class="variation-controls">
                <div class="variation-nav">
                    <button class="btn" onclick="holoSystem.previousVariant()">← Prev Preset</button>
                    <button class="btn" onclick="randomizeParameters('Holographic')">🎲 Randomize</button>
                    <button class="btn" onclick="holoSystem.nextVariant()">Next Preset →</button>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Hologram Variant <span class="control-display" id="holoVariationDisplay">1</span>
                    </label>
                    <input type="range" id="holoVariationSlider" class="control-input" min="0" max="29" value="0" 
                           onchange="holoSystem.setVariant(parseInt(this.value)); updateHoloDisplay();">
                </div>
                
                <div class="variation-info">
                    <div id="currentHoloVariation">1 - TETRAHEDRON LATTICE</div>
                </div>
            </div>
            
            <div class="geometry-presets">
                <button class="btn holo-geom active" data-holo-geometry="0" onclick="setHoloGeometry(0)">Tetrahedron</button>
                <button class="btn holo-geom" data-holo-geometry="4" onclick="setHoloGeometry(4)">Hypercube</button>
                <button class="btn holo-geom" data-holo-geometry="8" onclick="setHoloGeometry(8)">Sphere</button>
                <button class="btn holo-geom" data-holo-geometry="12" onclick="setHoloGeometry(12)">Torus</button>
                <button class="btn holo-geom" data-holo-geometry="16" onclick="setHoloGeometry(16)">Klein Bottle</button>
                <button class="btn holo-geom" data-holo-geometry="20" onclick="setHoloGeometry(20)">Fractal</button>
                <button class="btn holo-geom" data-holo-geometry="23" onclick="setHoloGeometry(23)">Wave</button>
                <button class="btn holo-geom" data-holo-geometry="26" onclick="setHoloGeometry(26)">Crystal</button>
            </div>
            
            <!-- HOLOGRAPHIC PARAMETER CONTROLS -->
            <div style="margin-top: 20px; border-top: 1px solid rgba(0,255,255,0.3); padding-top: 15px;">
                <h4 style="color: #00ffff; margin-bottom: 10px;">🎛️ Holographic Parameters</h4>
                
                <div class="control-group">
                    <label class="control-label">
                        Density <span class="control-display" id="holoDensityDisplay">1.00</span>
                    </label>
                    <input type="range" id="holoDensity" class="control-input" min="0.5" max="3.0" step="0.1" value="1.0" 
                           oninput="updateHoloParameter('density', this.value); this.nextElementSibling.querySelector('.control-display').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Speed <span class="control-display" id="holoSpeedDisplay">0.50</span>
                    </label>
                    <input type="range" id="holoSpeed" class="control-input" min="0.1" max="2.0" step="0.1" value="0.5" 
                           oninput="updateHoloParameter('speed', this.value); document.getElementById('holoSpeedDisplay').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Chaos <span class="control-display" id="holoChaosDisplay">0.00</span>
                    </label>
                    <input type="range" id="holoChaos" class="control-input" min="0" max="1" step="0.05" value="0" 
                           oninput="updateHoloParameter('chaos', this.value); document.getElementById('holoChaosDisplay').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Morph <span class="control-display" id="holoMorphDisplay">0.00</span>
                    </label>
                    <input type="range" id="holoMorph" class="control-input" min="0" max="1" step="0.05" value="0" 
                           oninput="updateHoloParameter('morph', this.value); document.getElementById('holoMorphDisplay').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Hue <span class="control-display" id="holoHueDisplay">0°</span>
                    </label>
                    <input type="range" id="holoHue" class="control-input" min="0" max="360" step="5" value="0" 
                           oninput="updateHoloParameter('hue', this.value); document.getElementById('holoHueDisplay').textContent = this.value + '°'">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Saturation <span class="control-display" id="holoSaturationDisplay">0.80</span>
                    </label>
                    <input type="range" id="holoSaturation" class="control-input" min="0" max="1" step="0.05" value="0.8" 
                           oninput="updateHoloParameter('saturation', this.value); document.getElementById('holoSaturationDisplay').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Intensity <span class="control-display" id="holoIntensityDisplay">0.50</span>
                    </label>
                    <input type="range" id="holoIntensity" class="control-input" min="0.1" max="1" step="0.05" value="0.5" 
                           oninput="updateHoloParameter('intensity', this.value); document.getElementById('holoIntensityDisplay').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn" id="holoAudioToggle" onclick="toggleHolographicAudio()" style="flex: 1; font-size: 0.7rem;">🎵 Audio On</button>
                        <button class="btn" onclick="saveHologramToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">💾 Save</button>
                    </div>
                    <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">🖼️ View Portfolio</button>
                </div>
            </div>
            
            <div style="margin-top: 20px; font-size: 0.8rem; color: rgba(255,255,255,0.7);">
                <p>✨ Multi-layer holographic effects</p>
                <p>🎨 Audio-reactive visualizations</p>
                <p>🔮 30 base variants + custom portfolio</p>
                <p>🖱️ Mouse, touch, scroll, audio interactions</p>
            </div>
        </div>
        
        <!-- Export Tab -->
        <div class="tab-content" id="export-tab">
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 10px;">Export</h3>
                <button class="btn" onclick="engine.exportJSON()" style="width: 100%; margin-bottom: 5px;">Export JSON Config</button>
                <button class="btn" onclick="engine.exportCSS()" style="width: 100%; margin-bottom: 5px;">Export CSS Theme</button>
                <button class="btn" onclick="engine.exportHTML()" style="width: 100%; margin-bottom: 5px;">Export HTML Page</button>
                <button class="btn" onclick="engine.exportPNG()" style="width: 100%; margin-bottom: 15px;">Export PNG Image</button>
            </div>
            
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 10px;">Import</h3>
                <button class="btn" onclick="engine.importJSON()" style="width: 100%; margin-bottom: 5px;">Import JSON Config</button>
                <button class="btn" onclick="engine.importFolder()" style="width: 100%;">Import Folder</button>
            </div>
        </div>
    </div>
    
    <!-- Status Display -->
    <div id="status" class="status"></div>
    
    <!-- Load ES6 Modules -->
    <script type="module">
        // Check for preview mode
        const urlParams = new URLSearchParams(window.location.search);
        const isPreviewMode = urlParams.get('preview') === 'true' || urlParams.get('hideui') === 'true';
        
        if (isPreviewMode) {
            document.body.classList.add('preview-mode');
            console.log('🔍 Preview mode activated - UI hidden');
        }
        
        // Load parameters from URL if available
        if (window.loadParametersFromURL) {
            loadParametersFromURL(urlParams);
        }
        
        // Add cache busting to prevent old file conflicts
        const cacheBuster = '?v=' + Date.now();
        
        // Load main VIB34D Engine
        import('./src/core/Engine.js' + cacheBuster).then(module => {
            const { VIB34DIntegratedEngine } = module;
            
            // Initialize VIB34D Engine
            window.engine = new VIB34DIntegratedEngine();
            
            console.log('🌌 VIB34D Holographic Engine - Refactored Version Loaded');
            console.log('✅ 5-Layer Holographic Rendering Active');
            console.log('🔮 100 Geometric Variations Available');
            console.log('🧮 4D Polytopal Mathematics Ready');
            console.log('🎮 Interactive Controls Enabled');
        }).catch(error => {
            console.error('❌ Failed to load VIB34D Engine:', error);
            document.body.innerHTML += '<div style="color: red; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: black; padding: 20px; border: 1px solid red;">VIB34D Loading Error: ' + error.message + '</div>';
        });
        
        // Load REAL Holographic System for Active Holograms tab ONLY
        import('./src/holograms/RealHolographicSystem.js' + cacheBuster).then(module => {
            const { RealHolographicSystem } = module;
            
            // Initialize REAL Holographic System for the Active Holograms tab
            window.realHoloSystem = new RealHolographicSystem();
            
            // CRITICAL: Initialize with default parameters after creation
            setTimeout(() => {
                if (window.realHoloSystem && window.realHoloSystem.visualizers.length > 0) {
                    console.log('🔧 Initializing holographic default parameters...');
                    
                    // Set reasonable default parameters
                    const defaultParams = {
                        geometryType: 0,
                        density: 1.0,
                        speed: 0.5,
                        chaos: 0.0,
                        morph: 0.0,
                        hue: 200,
                        saturation: 0.8,
                        intensity: 0.5,
                        name: 'DEFAULT TETRAHEDRON'
                    };
                    
                    // Apply to all visualizers
                    window.realHoloSystem.visualizers.forEach(viz => {
                        viz.variantParams = { ...defaultParams };
                        viz.roleParams = viz.generateRoleParams(viz.role);
                    });
                    
                    // Update UI sliders to match
                    updateHoloSliders(defaultParams);
                    
                    console.log('✨ Holographic system initialized with default parameters');
                }
            }, 100);
            
            console.log('✨ REAL Active Holographic System Loaded for Active Holograms tab');
            console.log('🔮 30 VIB3 Elaborate Holographic Variants with Complex Shaders');
        }).catch(error => {
            console.error('❌ Failed to load REAL Holographic System:', error);
        });
        
        // ================================
        // UNIFIED PARAMETER SYSTEM
        // ================================
        
        // Global parameter state shared across all systems
        window.unifiedParameters = {
            // Visual parameters (shared)
            density: 1.5,
            speed: 0.8,
            chaos: 0.3,
            morph: 0.5,
            hue: 200,
            saturation: 0.8,
            intensity: 0.6,
            
            // System-specific
            systemType: 'VIB34D', // 'VIB34D' or 'Holographic'
            variation: 0,
            geometryType: 0,
            
            // 4D Math (VIB34D only)
            rot4dXW: 0,
            rot4dYW: 0,
            rot4dZW: 0,
            dimension: 3.5,
            
            // Audio
            audioEnabled: false
        };
        
        // RANDOMIZATION SYSTEM - RANDOMIZE ACTUAL PARAMETERS NOT PRESETS!
        window.randomizeParameters = function(systemType = null) {
            const targetSystem = systemType || unifiedParameters.systemType;
            
            console.log(`🎲 RANDOMIZING ACTUAL PARAMETERS for ${targetSystem} system`);
            
            if (targetSystem === 'VIB34D' && window.engine) {
                // RANDOMIZE ALL VIB34D PARAMETERS - NOT PRESET VARIATIONS!
                const randomParams = {
                    // 4D Mathematics - completely random
                    rot4dXW: (Math.random() - 0.5) * 4,      // -2 to +2  
                    rot4dYW: (Math.random() - 0.5) * 4,      // -2 to +2
                    rot4dZW: (Math.random() - 0.5) * 4,      // -2 to +2
                    dimension: 3.0 + Math.random() * 1.5,    // 3.0 to 4.5
                    
                    // Visual Parameters - completely random
                    gridDensity: 4 + Math.random() * 26,     // 4 to 30
                    morphFactor: Math.random() * 2,          // 0 to 2
                    chaos: Math.random(),                    // 0 to 1
                    speed: 0.1 + Math.random() * 2.9,        // 0.1 to 3
                    hue: Math.floor(Math.random() * 360),    // 0 to 360
                    
                    // Random geometry type
                    geometry: Math.floor(Math.random() * 8)  // 0 to 7
                };
                
                // Apply randomized parameters
                window.engine.parameterManager.setParameters(randomParams);
                window.engine.updateDisplayValues();
                window.engine.updateVisualizers();
                
                // Update geometry button to show active geometry
                document.querySelectorAll('[data-geometry]').forEach(btn => {
                    btn.classList.toggle('active', parseInt(btn.dataset.geometry) === randomParams.geometry);
                });
                
                showParameterNotification('🎲 VIB34D Parameters Randomized!', 'Create unique combination - Save if you like it!');
                
            } else if (targetSystem === 'Holographic' && window.realHoloSystem) {
                // RANDOMIZE HOLOGRAPHIC PARAMETERS - DIRECT PARAMETER CONTROL
                const randomHoloParams = {
                    geometryType: Math.floor(Math.random() * 8),  // 0-7 geometry types
                    density: 0.5 + Math.random() * 2.5,          // 0.5 to 3.0
                    speed: 0.1 + Math.random() * 1.9,            // 0.1 to 2.0
                    chaos: Math.random(),                        // 0.0 to 1.0
                    morph: Math.random(),                        // 0.0 to 1.0
                    hue: Math.floor(Math.random() * 360),        // 0 to 360
                    saturation: 0.3 + Math.random() * 0.7,       // 0.3 to 1.0
                    intensity: 0.2 + Math.random() * 0.8,        // 0.2 to 1.0
                    name: 'CUSTOM RANDOMIZED'
                };
                
                // Apply randomized parameters directly to ALL visualizers  
                window.realHoloSystem.visualizers.forEach(viz => {
                    // Override the variant params with our randomized values
                    viz.variantParams = { ...randomHoloParams };
                    // CRITICAL: Regenerate role params based on new variant params
                    viz.roleParams = viz.generateRoleParams(viz.role);
                    console.log(`🎲 Applied random params to ${viz.role}:`, viz.variantParams);
                });
                
                // Update UI sliders to match randomized values
                updateHoloSliders(randomHoloParams);
                
                // Update geometry buttons to show active geometry
                document.querySelectorAll('.holo-geom').forEach(btn => btn.classList.remove('active'));
                const activeGeomBtn = document.querySelector(`[data-holo-geometry="${randomHoloParams.geometryType * 4}"]`);
                if (activeGeomBtn) activeGeomBtn.classList.add('active');
                
                // Update variant display with custom name
                const nameDisplay = document.getElementById('currentHoloVariation');
                if (nameDisplay) {
                    nameDisplay.textContent = `Custom - ${randomHoloParams.name}`;
                }
                
                showParameterNotification('🎲 Holographic Parameters Randomized!', 'Unique combination created - Save if you like it!');
            }
            
            unifiedParameters.systemType = targetSystem;
        };
        
        // QUICK RANDOMIZE - VISUAL PARAMETERS ONLY (NOT PRESETS!)
        window.quickRandomize = function() {
            console.log('⚡ Quick randomizing VISUAL parameters only');
            
            if (unifiedParameters.systemType === 'VIB34D' && window.engine) {
                // Quick randomize ONLY visual parameters - keep 4D math and geometry same
                const currentParams = window.engine.parameterManager.getAllParameters();
                
                const visualOnlyParams = {
                    // Keep current 4D math and geometry - only randomize visual aspects
                    gridDensity: 4 + Math.random() * 26,     // Visual density
                    morphFactor: Math.random() * 2,          // Visual morphing
                    chaos: Math.random(),                    // Visual chaos/noise
                    speed: 0.1 + Math.random() * 2.9,        // Animation speed
                    hue: Math.floor(Math.random() * 360)     // Color hue
                };
                
                window.engine.parameterManager.setParameters(visualOnlyParams);
                window.engine.updateDisplayValues();
                window.engine.updateVisualizers();
                
                showParameterNotification('⚡ Visual Randomized!', 'Colors & effects changed - 4D math kept same');
                
            } else if (window.realHoloSystem && (window.realHoloSystem.isActive || unifiedParameters.systemType === 'Holographic')) {
                // Quick randomize holographic VISUAL parameters only
                const currentParams = window.realHoloSystem.visualizers[0]?.variantParams || {};
                
                const visualParams = {
                    // Keep geometry and morph - only randomize visual aspects
                    geometryType: currentParams.geometryType || 0,
                    morph: currentParams.morph || 0,
                    
                    // Randomize visual parameters
                    density: 0.5 + Math.random() * 2.5,      
                    speed: 0.1 + Math.random() * 1.9,        
                    chaos: Math.random(),                    
                    hue: Math.floor(Math.random() * 360),    
                    saturation: 0.5 + Math.random() * 0.5,   
                    intensity: 0.3 + Math.random() * 0.7,
                    name: currentParams.name || 'CUSTOM VISUAL'    
                };
                
                // Apply visual params by updating variant params (keep geometry/morph)
                window.realHoloSystem.visualizers.forEach(viz => {
                    // Merge new visual params with existing params
                    viz.variantParams = { ...viz.variantParams, ...visualParams };
                    // CRITICAL: Regenerate role params
                    viz.roleParams = viz.generateRoleParams(viz.role);
                    console.log(`⚡ Applied visual params to ${viz.role}:`, visualParams);
                });
                
                updateHoloSliders(visualParams);
                showParameterNotification('⚡ Visual Randomized!', 'Colors & effects changed - geometry kept same');
            }
        };
        
        // PARAMETER APPLICATION SYSTEM
        window.applyUnifiedParameters = function(newParams, targetSystem = null) {
            const system = targetSystem || unifiedParameters.systemType;
            
            // Update global state
            Object.assign(unifiedParameters, newParams);
            
            // Apply to UI sliders
            updateAllSliders(newParams, system);
            
            // Apply to active system
            if (system === 'VIB34D' && window.engine) {
                applyToVIB34D(newParams);
            } else if (system === 'Holographic' && window.realHoloSystem) {
                applyToHolographic(newParams);
            }
            
            console.log('🔄 Applied unified parameters:', newParams);
        };
        
        // Update all UI sliders
        function updateAllSliders(params, system) {
            // Implementation for updating sliders
            console.log('Updating sliders:', params);
        }
        
        // Apply parameters to VIB34D system  
        function applyToVIB34D(params) {
            if (!window.engine) return;
            console.log('Applying to VIB34D:', params);
        }
        
        // Apply parameters to Holographic system
        function applyToHolographic(params) {
            if (!window.realHoloSystem) return;
            console.log('Applying to Holographic:', params);
        }
        
        // Parameter notification system
        function showParameterNotification(title, message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(145deg, rgba(0, 255, 255, 0.9), rgba(0, 200, 255, 0.8));
                color: #000;
                padding: 12px 20px;
                border-radius: 8px;
                font-family: 'Orbitron', monospace;
                font-size: 0.8rem;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0, 255, 255, 0.3);
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 250px;
            `;
            
            notification.innerHTML = `
                <div style="margin-bottom: 4px;">${title}</div>
                <div style="font-size: 0.7rem; opacity: 0.8;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // SYSTEM SWITCHING - ACTUALLY WORKING VERSION
        window.switchToSystem = function(systemType) {
            if (unifiedParameters.systemType === systemType) return;
            
            console.log(`🔄 Switching to ${systemType} system`);
            
            if (systemType === 'Holographic') {
                // Activate holographic system
                if (window.realHoloSystem) {
                    window.realHoloSystem.setActive(true);
                    
                    // Switch to Active Holograms tab
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    const holoTab = document.querySelector('[data-tab="holograms"]');
                    const holoContent = document.getElementById('holograms-tab');
                    
                    if (holoTab && holoContent) {
                        holoTab.classList.add('active');
                        holoContent.classList.add('active');
                    }
                    
                    // Update toggle button
                    const toggleBtn = document.getElementById('toggle-holo');
                    if (toggleBtn) {
                        toggleBtn.textContent = 'Deactivate Holograms';
                        toggleBtn.style.background = 'rgba(255, 100, 100, 0.3)';
                    }
                }
                
            } else if (systemType === 'VIB34D') {
                // Deactivate holographic system, activate VIB34D
                if (window.realHoloSystem) {
                    window.realHoloSystem.setActive(false);
                    
                    // Switch to VIB34D tab
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    const vib34dTab = document.querySelector('[data-tab="variations"]');
                    const vib34dContent = document.getElementById('variations-tab');
                    
                    if (vib34dTab && vib34dContent) {
                        vib34dTab.classList.add('active');
                        vib34dContent.classList.add('active');
                    }
                    
                    // Update toggle button
                    const toggleBtn = document.getElementById('toggle-holo');
                    if (toggleBtn) {
                        toggleBtn.textContent = 'Activate Holograms';
                        toggleBtn.style.background = 'rgba(0, 255, 255, 0.2)';
                    }
                }
            }
            
            unifiedParameters.systemType = systemType;
            
            // Update UI indicator
            const indicator = document.getElementById('currentSystemIndicator');
            if (indicator) {
                indicator.textContent = systemType === 'VIB34D' ? '🔷 VIB34D System' : '✨ Holographic System';
            }
            
            showParameterNotification(`🔄 Switched to ${systemType}`, 'System active and ready');
        };
        
        // Enhanced URL parameter loading
        window.loadParametersFromURL = function(urlParams) {
            console.log('🔗 Loading parameters from URL...');
            // Implementation for loading URL parameters
        };
        
        // Collapsible Control Panel
        window.toggleControlPanel = function() {
            const panel = document.getElementById('controlPanel');
            const toggle = document.getElementById('collapseToggle');
            
            panel.classList.toggle('collapsed');
            
            if (panel.classList.contains('collapsed')) {
                toggle.textContent = '›';
                toggle.title = 'Expand Control Panel';
            } else {
                toggle.textContent = '‹';
                toggle.title = 'Collapse Control Panel';
            }
        };
        
        // Keyboard shortcut for panel collapse
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab' && e.ctrlKey) {
                e.preventDefault();
                toggleControlPanel();
            }
        });
        
        // ACTUAL WORKING FUNCTIONS - NO MORE PLACEHOLDERS!
        window.toggleHolographicSystem = function() {
            if (window.realHoloSystem) {
                const isActive = window.realHoloSystem.isActive;
                window.realHoloSystem.setActive(!isActive);
                
                // Update button text
                const toggleBtn = document.getElementById('toggle-holo');
                if (toggleBtn) {
                    if (!isActive) {
                        toggleBtn.textContent = 'Deactivate Holograms';
                        toggleBtn.style.background = 'rgba(255, 100, 100, 0.3)';
                        switchToSystem('Holographic');
                    } else {
                        toggleBtn.textContent = 'Activate Holograms';
                        toggleBtn.style.background = 'rgba(0, 255, 255, 0.2)';
                        switchToSystem('VIB34D');
                    }
                }
            }
        };
        
        window.updateHoloParameter = function(param, value) {
            if (window.realHoloSystem && window.realHoloSystem.visualizers.length > 0) {
                const numValue = parseFloat(value);
                console.log(`🎛️ Updating holographic ${param} to ${numValue}`);
                
                // Update all visualizers' variant parameters directly
                window.realHoloSystem.visualizers.forEach(viz => {
                    if (viz.variantParams) {
                        // Update the specific parameter
                        viz.variantParams[param] = numValue;
                        
                        // CRITICAL: Regenerate role params based on updated variant params
                        viz.roleParams = viz.generateRoleParams(viz.role);
                        
                        console.log(`Updated visualizer ${viz.role} with ${param}=${numValue}`);
                    }
                });
            }
        };
        
        window.toggleVIB34DAudio = function() {
            // Toggle VIB34D audio reactivity
            unifiedParameters.audioEnabled = !unifiedParameters.audioEnabled;
            const buttons = document.querySelectorAll('#vib34dAudioToggle, #vib34dAudioToggle2');
            buttons.forEach(btn => {
                btn.textContent = unifiedParameters.audioEnabled ? '🎵 Audio On' : '🎵 Audio Off';
            });
            console.log('VIB34D audio:', unifiedParameters.audioEnabled ? 'ON' : 'OFF');
        };
        
        window.toggleHolographicAudio = function() {
            if (window.realHoloSystem) {
                const wasEnabled = window.realHoloSystem.audioEnabled;
                if (!wasEnabled) {
                    window.realHoloSystem.initAudio();
                } else {
                    window.realHoloSystem.audioEnabled = false;
                }
                
                const toggleBtn = document.getElementById('holoAudioToggle');
                if (toggleBtn) {
                    toggleBtn.textContent = window.realHoloSystem.audioEnabled ? '🎵 Audio On' : '🎵 Audio Off';
                }
            }
        };
        
        window.saveVIB34DToPortfolio = function() {
            if (window.engine) {
                const saved = window.engine.saveAsCustomVariation();
                if (saved !== -1) {
                    showParameterNotification('💾 Saved!', `Current parameters saved as custom variation ${saved + 1}`);
                } else {
                    showParameterNotification('⚠ Full!', 'All custom slots are full - delete some old ones first');
                }
            }
        };
        
        window.saveHologramToPortfolio = function() {
            if (window.realHoloSystem && window.realHoloSystem.visualizers.length > 0) {
                // Save current holographic parameters (not just variant number)
                const currentParams = window.realHoloSystem.visualizers[0].variantParams;
                
                const holoData = {
                    type: 'holographic-custom',
                    timestamp: new Date().toISOString(),
                    name: `HOLO CUSTOM ${new Date().toLocaleTimeString()}`,
                    parameters: { ...currentParams }
                };
                
                const saved = localStorage.getItem('vib34d-holo-portfolio');
                let portfolio = saved ? JSON.parse(saved) : [];
                portfolio.push(holoData);
                localStorage.setItem('vib34d-holo-portfolio', JSON.stringify(portfolio));
                
                showParameterNotification('💾 Hologram Saved!', `Custom parameters saved as "${holoData.name}"`);
            }
        };
        
        window.openUnifiedGallery = function() {
            // First, let's create a simple inline gallery instead of external file
            showUnifiedGallery();
        };
        
        window.showUnifiedGallery = function() {
            // Get saved items from both systems
            const vib34dSaves = JSON.parse(localStorage.getItem('vib34d-custom-variations') || '[]').filter(v => v !== null);
            const holoSaves = JSON.parse(localStorage.getItem('vib34d-holo-portfolio') || '[]');
            
            let galleryHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; padding: 20px;">
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h1 style="color: #00ffff; font-family: 'Orbitron', monospace; font-size: 2rem;">🖼️ VIB34D Portfolio Gallery</h1>
                            <button onclick="this.closest('div').remove()" style="background: rgba(255,0,0,0.3); border: 1px solid #ff0000; color: #ff0000; padding: 10px 20px; border-radius: 5px; cursor: pointer;">✕ Close</button>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h2 style="color: #00ffff; font-family: 'Orbitron', monospace; margin-bottom: 15px;">🔷 VIB34D Custom Variations (${vib34dSaves.length})</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
            `;
            
            // Add VIB34D saves
            vib34dSaves.forEach((save, index) => {
                if (save && save.parameters) {
                    galleryHTML += `
                        <div style="background: rgba(0,255,255,0.1); border: 1px solid rgba(0,255,255,0.3); border-radius: 8px; padding: 15px; cursor: pointer;" 
                             onclick="loadVIB34DParameters(${index})">
                            <h3 style="color: #00ffff; font-size: 0.9rem; margin-bottom: 8px;">${save.name || 'Custom Variation'}</h3>
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">${new Date(save.timestamp).toLocaleString()}</div>
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.5);">
                                Geo: ${save.parameters.geometry || 0} | Hue: ${save.parameters.hue || 0}° | Chaos: ${(save.parameters.chaos || 0).toFixed(2)}
                            </div>
                        </div>
                    `;
                }
            });
            
            galleryHTML += `
                            </div>
                        </div>
                        
                        <div>
                            <h2 style="color: #00ffff; font-family: 'Orbitron', monospace; margin-bottom: 15px;">✨ Holographic Custom Creations (${holoSaves.length})</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
            `;
            
            // Add Holographic saves
            holoSaves.forEach((save, index) => {
                if (save && save.parameters) {
                    galleryHTML += `
                        <div style="background: rgba(255,100,255,0.1); border: 1px solid rgba(255,100,255,0.3); border-radius: 8px; padding: 15px; cursor: pointer;" 
                             onclick="loadHolographicParameters(${index})">
                            <h3 style="color: #ff64ff; font-size: 0.9rem; margin-bottom: 8px;">${save.name || 'Custom Hologram'}</h3>
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">${new Date(save.timestamp).toLocaleString()}</div>
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.5);">
                                Geo: ${save.parameters.geometryType || 0} | Hue: ${save.parameters.hue || 0}° | Density: ${(save.parameters.density || 0).toFixed(2)}
                            </div>
                        </div>
                    `;
                }
            });
            
            galleryHTML += `
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', galleryHTML);
        };
        
        window.loadVIB34DParameters = function(index) {
            const saves = JSON.parse(localStorage.getItem('vib34d-custom-variations') || '[]').filter(v => v !== null);
            const save = saves[index];
            if (save && save.parameters && window.engine) {
                window.engine.parameterManager.setParameters(save.parameters);
                window.engine.updateDisplayValues();
                window.engine.updateVisualizers();
                switchToSystem('VIB34D');
                showParameterNotification('💾 Loaded!', `VIB34D parameters from "${save.name}"`);
            }
        };
        
        window.loadHolographicParameters = function(index) {
            const saves = JSON.parse(localStorage.getItem('vib34d-holo-portfolio') || '[]');
            const save = saves[index];
            if (save && save.parameters && window.realHoloSystem) {
                // Apply loaded parameters to all visualizers
                window.realHoloSystem.visualizers.forEach(viz => {
                    viz.variantParams = { ...save.parameters };
                    viz.roleParams = viz.generateRoleParams(viz.role);
                });
                
                // Update UI sliders
                updateHoloSliders(save.parameters);
                
                switchToSystem('Holographic');
                showParameterNotification('💾 Loaded!', `Holographic parameters from "${save.name}"`);
            }
        };
        
        // REAL Holographic system interface - ACTUALLY WORKING!
        window.holoSystem = {
            setVariant: function(variant) { 
                if (window.realHoloSystem) {
                    window.realHoloSystem.setVariant(parseInt(variant));
                    updateHoloDisplay();
                }
            },
            nextVariant: function() { 
                if (window.realHoloSystem) {
                    window.realHoloSystem.nextVariant();
                    updateHoloDisplay();
                }
            },
            previousVariant: function() { 
                if (window.realHoloSystem) {
                    window.realHoloSystem.previousVariant();
                    updateHoloDisplay();
                }
            },
            randomVariant: function() { 
                // Use our new parameter randomization instead of preset variants
                randomizeParameters('Holographic');
            }
        };
        
        // Helper functions for holographic system
        window.updateHoloDisplay = function() {
            if (window.realHoloSystem) {
                const variantInfo = window.realHoloSystem.getCurrentVariantInfo();
                
                // Update slider
                const slider = document.getElementById('holoVariationSlider');
                if (slider) {
                    slider.value = variantInfo.variant;
                }
                
                // Update displays
                const variantDisplay = document.getElementById('holoVariationDisplay');
                if (variantDisplay) {
                    variantDisplay.textContent = variantInfo.variant + 1;
                }
                
                const nameDisplay = document.getElementById('currentHoloVariation');
                if (nameDisplay) {
                    nameDisplay.textContent = `${variantInfo.variant + 1} - ${variantInfo.name}`;
                }
            }
        };
        
        window.setHoloGeometry = function(geometryIndex) {
            // Update geometry buttons
            document.querySelectorAll('.holo-geom').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-holo-geometry="${geometryIndex}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            // Set holographic geometry directly in parameters (not preset variants)
            if (window.realHoloSystem) {
                const baseGeometry = Math.floor(geometryIndex / 4); // 0,1,2,3,4... -> geometry type
                
                // Update all visualizers with new geometry but keep other params
                window.realHoloSystem.visualizers.forEach(viz => {
                    if (viz.variantParams) {
                        viz.variantParams.geometryType = baseGeometry;
                        // CRITICAL: Regenerate role params with new geometry
                        viz.roleParams = viz.generateRoleParams(viz.role);
                        console.log(`🔷 Set geometry ${baseGeometry} on ${viz.role}`);
                    }
                });
                
                // Update variant display
                const nameDisplay = document.getElementById('currentHoloVariation');
                if (nameDisplay) {
                    const geometryNames = ['TETRAHEDRON', 'HYPERCUBE', 'SPHERE', 'TORUS', 'KLEIN BOTTLE', 'FRACTAL', 'WAVE', 'CRYSTAL'];
                    nameDisplay.textContent = `Custom - ${geometryNames[baseGeometry]} GEOMETRY`;
                }
                
                console.log(`Set holographic geometry to type ${baseGeometry}`);
            }
        };
        
        window.updateHoloSliders = function(params) {
            // Update all holographic parameter sliders and displays
            const paramMap = {
                density: 'holoDensity',
                speed: 'holoSpeed', 
                chaos: 'holoChaos',
                morph: 'holoMorph',
                hue: 'holoHue',
                saturation: 'holoSaturation',
                intensity: 'holoIntensity'
            };
            
            Object.keys(params).forEach(param => {
                const sliderId = paramMap[param];
                if (sliderId) {
                    const slider = document.getElementById(sliderId);
                    const display = document.getElementById(sliderId + 'Display');
                    
                    if (slider) {
                        slider.value = params[param];
                    }
                    
                    if (display) {
                        display.textContent = param === 'hue' ? params[param] + '°' : parseFloat(params[param]).toFixed(2);
                    }
                }
            });
            
            console.log('🎛️ Updated holographic sliders:', params);
            
            // DEBUG: Let's also verify the visualizers actually have these parameters
            if (window.realHoloSystem && window.realHoloSystem.visualizers.length > 0) {
                const firstViz = window.realHoloSystem.visualizers[0];
                console.log('🔍 First visualizer params after slider update:', firstViz.variantParams);
            }
        };
        
        // DEBUG: Test function to verify parameter system is working
        window.testHoloParameters = function() {
            if (!window.realHoloSystem || window.realHoloSystem.visualizers.length === 0) {
                console.error('❌ Holographic system not ready');
                return;
            }
            
            console.log('🧪 Testing holographic parameter system...');
            
            // Test sequence: Change hue dramatically
            let hue = 0;
            const testInterval = setInterval(() => {
                hue = (hue + 60) % 360;
                updateHoloParameter('hue', hue);
                
                // Also test intensity
                const intensity = 0.2 + Math.random() * 0.6;
                updateHoloParameter('intensity', intensity);
                
                console.log(`🌈 Test: Hue=${hue}°, Intensity=${intensity.toFixed(2)}`);
                
                if (hue === 0) {
                    clearInterval(testInterval);
                    console.log('✅ Parameter test complete');
                }
            }, 500);
        };
        
        // Add a debug function to inspect current holographic state
        window.debugHoloSystem = function() {
            if (!window.realHoloSystem) {
                console.log('❌ No holographic system loaded');
                return;
            }
            
            console.log('🔍 HOLOGRAPHIC SYSTEM DEBUG:');
            console.log('Active:', window.realHoloSystem.isActive);
            console.log('Visualizers:', window.realHoloSystem.visualizers.length);
            
            window.realHoloSystem.visualizers.forEach((viz, i) => {
                console.log(`Visualizer ${i} (${viz.role}):`);
                console.log('  Variant Params:', viz.variantParams);
                console.log('  Role Params:', viz.roleParams);
            });
        };
        
        // Add keyboard shortcuts for debugging
        document.addEventListener('keydown', (e) => {
            // Skip if user is focused on input elements
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
            
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                testHoloParameters();
            }
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                debugHoloSystem();
            }
        });
        
    </script>
</body>
</html>